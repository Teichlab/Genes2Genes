<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Min max normalize the pseudotime &mdash; Genes2Genes v1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=99a04888"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Genes2Genes
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Genes2Genes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Genes2Genes</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Min max normalize the pseudotime</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/G2G_Tutorial.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">anndata</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sb</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">from</span> <span class="nn">optbinning</span> <span class="kn">import</span> <span class="n">ContinuousOptimalBinning</span>

<span class="kn">import</span> <span class="nn">Main</span>
<span class="kn">import</span> <span class="nn">VisualUtils</span>
<span class="kn">import</span> <span class="nn">ClusterUtils</span>
<span class="kn">import</span> <span class="nn">TimeSeriesPreprocessor</span>
<span class="kn">import</span> <span class="nn">PathwayAnalyserV2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">python_version</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 6&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">import</span> <span class="nn">platform</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">optbinning</span> <span class="kn">import</span> <span class="n">ContinuousOptimalBinning</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">Main</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="kn">import</span> <span class="nn">VisualUtils</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;optbinning&#39;
</pre></div>
</div>
</div>
</div>
<p>Load the reference and query anndata objects</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_dir</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span>
<span class="n">adata_ref</span> <span class="o">=</span> <span class="n">anndata</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">+</span> <span class="s1">&#39;adata_pam_local.h5ad&#39;</span><span class="p">)</span> <span class="c1"># PAM dataset</span>
<span class="n">adata_query</span> <span class="o">=</span> <span class="n">anndata</span><span class="o">.</span><span class="n">read_h5ad</span><span class="p">(</span><span class="n">input_dir</span> <span class="o">+</span><span class="s1">&#39;adata_lps_local.h5ad&#39;</span><span class="p">)</span> <span class="c1"># LPS dataset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">adata_query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AnnData object with n_obs × n_vars = 179 × 89
    obs: &#39;time&#39;
AnnData object with n_obs × n_vars = 290 × 89
    obs: &#39;time&#39;
</pre></div>
</div>
</div>
</div>
<section id="min-max-normalize-the-pseudotime">
<h1>Min max normalize the pseudotime<a class="headerlink" href="#min-max-normalize-the-pseudotime" title="Permalink to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the current range</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>

<span class="c1"># if it does not follow [0,1] range, run below</span>
<span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TimeSeriesPreprocessor</span><span class="o">.</span><span class="n">Utils</span><span class="o">.</span><span class="n">minmax_normalise</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TimeSeriesPreprocessor</span><span class="o">.</span><span class="n">Utils</span><span class="o">.</span><span class="n">minmax_normalise</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 1.0
0.0 1.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the pseudotime distributions</span>
<span class="n">sb</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PAM&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;forestgreen&#39;</span><span class="p">)</span> 
<span class="n">sb</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LPS&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;midnightblue&#39;</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pseudotime&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9f89830ecc564797d3b60b6b15f2bb6f522db808f9a2c22df9b53f0a2a67673c.png" src="../_images/9f89830ecc564797d3b60b6b15f2bb6f522db808f9a2c22df9b53f0a2a67673c.png" />
</div>
</div>
</section>
<section id="check-the-number-of-bins-in-the-optimal-binning-structure-using-optbinning-package">
<h1>Check the number of bins in the optimal binning structure using OptBinning package<a class="headerlink" href="#check-the-number-of-bins-in-the-optimal-binning-structure-using-optbinning-package" title="Permalink to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">optb</span> <span class="o">=</span> <span class="n">ContinuousOptimalBinning</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pseudotime&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">)</span>
<span class="n">optb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">optb</span><span class="o">.</span><span class="n">splits</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">optb</span> <span class="o">=</span> <span class="n">ContinuousOptimalBinning</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;pseudotime&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;numerical&quot;</span><span class="p">)</span>
<span class="n">optb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">optb</span><span class="o">.</span><span class="n">splits</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14
14
</pre></div>
</div>
</div>
</div>
<p>OptBinning estimates 14 optimal number of splits for both reference and query pseudotime distributions. Therefore we choose the same number of interpolation points.</p>
</section>
<section id="visualize-the-interpolation-binning-structure-in-terms-of-the-cell-type-composition">
<h1>Visualize the interpolation binning structure in terms of the cell type composition<a class="headerlink" href="#visualize-the-interpolation-binning-structure-in-terms-of-the-cell-type-composition" title="Permalink to this heading"></a></h1>
<p>For this dataset, we use the author-given time annotations (1h,2h,4h,6h) as the cell-type annotations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">adata_ref</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata_ref</span><span class="o">.</span><span class="n">obs_names</span><span class="p">]</span> 
<span class="n">adata_query</span><span class="o">.</span><span class="n">obs</span><span class="p">[</span><span class="s1">&#39;annotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">adata_query</span><span class="o">.</span><span class="n">obs_names</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
<p>Next we define a colormap of our choice for these annotations, and call the below function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sb</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;colorblind&#39;</span><span class="p">))[</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">joint_cmap</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;1h&#39;</span><span class="p">:</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;2h&#39;</span><span class="p">:</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;4h&#39;</span><span class="p">:</span><span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;6h&#39;</span><span class="p">:</span><span class="n">col</span><span class="p">[</span><span class="mi">3</span><span class="p">]}</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">VisualUtils</span><span class="o">.</span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">get_celltype_composition_across_time</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> 
                                     <span class="n">ANNOTATION_COLNAME</span><span class="o">=</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="n">optimal_binning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ref_cmap</span><span class="o">=</span><span class="n">joint_cmap</span><span class="p">,</span> <span class="n">query_cmap</span><span class="o">=</span><span class="n">joint_cmap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># trying max n points for optimal binning = 14
====================================================
Optimal equal number of bins for R and Q =  14
</pre></div>
</div>
<img alt="../_images/1249cf2744ee0e02646e34175d71b6a67f9c42accae56a668d19e0b7878125e1.png" src="../_images/1249cf2744ee0e02646e34175d71b6a67f9c42accae56a668d19e0b7878125e1.png" />
<img alt="../_images/0f49cc6ea04e7560f7e38ef277c43c473fb2c114edb9c923ec54746560932631.png" src="../_images/0f49cc6ea04e7560f7e38ef277c43c473fb2c114edb9c923ec54746560932631.png" />
<img alt="../_images/c95cfd82d0a7db3db68f4105f9a6b9452a5d98606745711b11a9f9a91cc1ebfe.png" src="../_images/c95cfd82d0a7db3db68f4105f9a6b9452a5d98606745711b11a9f9a91cc1ebfe.png" />
</div>
</div>
</section>
<section id="run-g2g-alignment">
<h1>Run G2G alignment<a class="headerlink" href="#run-g2g-alignment" title="Permalink to this heading"></a></h1>
<p>We can now run Gene-level alignment for all 89 genes in the PAM and LPS datasets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gene_list</span> <span class="o">=</span> <span class="n">adata_ref</span><span class="o">.</span><span class="n">var_names</span> 
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gene_list</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>89
</pre></div>
</div>
</div>
</div>
<p>This is done by first creating an aligner object, passing and setting all relevant parameters.
Next we align all gene pairs. (This step is parallelizing indepedenent gene-alignments to make the process time-efficient, however the computational time for an individual alignment will increase as the number of cells and/or the number of interpolation time points increase.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aligner</span> <span class="o">=</span> <span class="n">Main</span><span class="o">.</span><span class="n">RefQueryAligner</span><span class="p">(</span><span class="n">adata_ref</span><span class="p">,</span> <span class="n">adata_query</span><span class="p">,</span> <span class="n">gene_list</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">optimal_bining_S</span><span class="p">))</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">WEIGHT_BY_CELL_DENSITY</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">WINDOW_SIZE</span><span class="o">=</span><span class="mf">0.1</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">state_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.7</span><span class="p">]</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">optimal_binning</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">opt_binning_S</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">optimal_bining_S</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">opt_binning_T</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">optimal_bining_T</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">align_all_pairs</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WINDOW_SIZE= 0.1
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "793a80e659c84f4783d1e40a698b6af5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<p>Now we can check the aggregate (average) alignment across all genes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aligner</span><span class="o">.</span><span class="n">get_aggregate_alignment</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average Alignment:  IDDDMMMMMMMMMIIIDID
</pre></div>
</div>
<img alt="../_images/4df0fb434f256a77fbd87625bbb67dcf1d4eefaffc075b69e6d86b2c48c7c0ae.png" src="../_images/4df0fb434f256a77fbd87625bbb67dcf1d4eefaffc075b69e6d86b2c48c7c0ae.png" />
</div>
</div>
<p>We can also visualize this alignment in terms of cell-type composition</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vs</span><span class="o">.</span><span class="n">visualize_gene_alignment</span><span class="p">(</span><span class="s2">&quot;IDDDMMMMMMMMMIIIDID&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">joint_cmap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d11b5c10fdf30ee12f0ac9bf62662279b20b939402bac51e4535d3c62221aa56.png" src="../_images/d11b5c10fdf30ee12f0ac9bf62662279b20b939402bac51e4535d3c62221aa56.png" />
</div>
</div>
<p>We can also visualize an individual gene (e.g. JUNB), displaying its alignment statistics</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">show_gene_alignment</span><span class="p">(</span><span class="s1">&#39;TNF&#39;</span><span class="p">,</span> <span class="n">aligner</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">joint_cmap</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DDDIDIDIDDDMMMMMIIIIIID
Optimal alignment cost: 57.99 nits
Alignment similarity percentage: 21.74 %
</pre></div>
</div>
<img alt="../_images/cb9d014d5019323a6c8df2f4490e4989b92f057d56da3fa55630e9f4c66c6e19.png" src="../_images/cb9d014d5019323a6c8df2f4490e4989b92f057d56da3fa55630e9f4c66c6e19.png" />
<img alt="../_images/5fdca400912538b8363649e2dba555b9f552160bed25ad93b6dfa30ca6062120.png" src="../_images/5fdca400912538b8363649e2dba555b9f552160bed25ad93b6dfa30ca6062120.png" />
</div>
</div>
<p>To check only the cell plots of a gene alignment (e.g. SERTAD2)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">plotTimeSeries</span><span class="p">(</span><span class="s1">&#39;SERTAD2&#39;</span><span class="p">,</span> <span class="n">aligner</span><span class="p">,</span> <span class="n">plot_cells</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c33d27ce8286995c53cd6a7a98836cadf5656d37f278b032aebe6842729ea3f7.png" src="../_images/c33d27ce8286995c53cd6a7a98836cadf5656d37f278b032aebe6842729ea3f7.png" />
</div>
</div>
<p>The below attributes and functions can be used to examine any gene-alignment object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GENE</span> <span class="o">=</span> <span class="s1">&#39;TNF&#39;</span>
<span class="n">gene_obj</span> <span class="o">=</span> <span class="n">aligner</span><span class="o">.</span><span class="n">results_map</span><span class="p">[</span><span class="n">GENE</span><span class="p">]</span>

<span class="n">al</span> <span class="o">=</span> <span class="n">gene_obj</span><span class="o">.</span><span class="n">alignment_str</span>
<span class="nb">print</span><span class="p">(</span><span class="n">al</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">color_al_str</span><span class="p">(</span><span class="n">al</span><span class="p">))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DDDIDIDIDDDMMMMMIIIIIID
DDDIDIDIDDDMMMMMIIIIIID
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gene_obj</span><span class="o">.</span><span class="n">al_visual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>01234567890123456789012 Alignment index 
012 3 4 56789012      3 Reference index
***-*-*-********------*
---*-*-*---***********-
   0 1 2   34567890123  Query index
DDDIDIDIDDDMMMMMIIIIIID 5-state string 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gene_obj</span><span class="o">.</span><span class="n">landscape_obj</span><span class="o">.</span><span class="n">plot_alignment_landscape</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a918c2cd67d97aede6980dfc0dfea90a00647fd39f6428459a820fd078809147.png" src="../_images/a918c2cd67d97aede6980dfc0dfea90a00647fd39f6428459a820fd078809147.png" />
</div>
</div>
</section>
<section id="the-alignment-distribution-across-all-genes">
<h1>The alignment distribution across all genes<a class="headerlink" href="#the-alignment-distribution-across-all-genes" title="Permalink to this heading"></a></h1>
<p>We can use the alignment similarity percentage statistic of genes to rank genes from highly distant to highly similar</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">aligner</span><span class="o">.</span><span class="n">get_stat_df</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean matched percentage: 
50.39 %
</pre></div>
</div>
<img alt="../_images/e57f23067cf79892be4203eaa502885c230fbc5fa7ceab708c80dfa868fec69f.png" src="../_images/e57f23067cf79892be4203eaa502885c230fbc5fa7ceab708c80dfa868fec69f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">plot_alignmentSim_vs_l2fc</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e61f45f76bc238b5b30c279753d0ef2a9569dc5963df7686d832ee4c9f24eb31.png" src="../_images/e61f45f76bc238b5b30c279753d0ef2a9569dc5963df7686d832ee4c9f24eb31.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gene</th>
      <th>alignment_similarity_percentage</th>
      <th>opt_alignment_cost</th>
      <th>l2fc</th>
      <th>color</th>
      <th>abs_l2fc</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>63</th>
      <td>CCRL2</td>
      <td>0.2174</td>
      <td>55.943685</td>
      <td>-0.487688</td>
      <td>red</td>
      <td>0.487688</td>
    </tr>
    <tr>
      <th>77</th>
      <td>NFKBIA</td>
      <td>0.2174</td>
      <td>54.673471</td>
      <td>-0.091748</td>
      <td>red</td>
      <td>0.091748</td>
    </tr>
    <tr>
      <th>68</th>
      <td>NLRP3</td>
      <td>0.2174</td>
      <td>57.177548</td>
      <td>0.069058</td>
      <td>red</td>
      <td>0.069058</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TNF</td>
      <td>0.2174</td>
      <td>57.990078</td>
      <td>-0.006439</td>
      <td>red</td>
      <td>0.006439</td>
    </tr>
    <tr>
      <th>45</th>
      <td>C5AR1</td>
      <td>0.2727</td>
      <td>57.858236</td>
      <td>0.8711</td>
      <td>red</td>
      <td>0.8711</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>34</th>
      <td>NUP54</td>
      <td>0.75</td>
      <td>30.744063</td>
      <td>0.012993</td>
      <td>green</td>
      <td>0.012993</td>
    </tr>
    <tr>
      <th>15</th>
      <td>CD44</td>
      <td>0.7647</td>
      <td>28.366715</td>
      <td>-0.021366</td>
      <td>green</td>
      <td>0.021366</td>
    </tr>
    <tr>
      <th>19</th>
      <td>PLAGL2</td>
      <td>0.8235</td>
      <td>31.807956</td>
      <td>-0.051268</td>
      <td>green</td>
      <td>0.051268</td>
    </tr>
    <tr>
      <th>51</th>
      <td>ZSWIM4</td>
      <td>0.8235</td>
      <td>30.214575</td>
      <td>0.030379</td>
      <td>green</td>
      <td>0.030379</td>
    </tr>
    <tr>
      <th>26</th>
      <td>SGMS2</td>
      <td>0.8667</td>
      <td>37.626682</td>
      <td>-0.020399</td>
      <td>green</td>
      <td>0.020399</td>
    </tr>
  </tbody>
</table>
<p>89 rows × 6 columns</p>
</div></div></div>
</div>
</section>
<section id="run-gene-set-overrepresentation-analysis-over-the-top-k-mismatching-genes">
<h1>Run gene set overrepresentation analysis over the top k mismatching genes<a class="headerlink" href="#run-gene-set-overrepresentation-analysis-over-the-top-k-mismatching-genes" title="Permalink to this heading"></a></h1>
<p>Let us use 30% alignment similarity (=0.3) as a threshold in this case</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">topDEgenes</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;alignment_similarity_percentage&#39;</span><span class="p">]</span> <span class="o">&lt;=</span><span class="mf">0.3</span><span class="p">)][</span><span class="s1">&#39;Gene&#39;</span><span class="p">]</span>
<span class="n">topDEgenes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>63      CCRL2
77     NFKBIA
68      NLRP3
3         TNF
45      C5AR1
84    SPATA13
33      CXCL2
12     RALGDS
31     INSIG1
6       MALT1
Name: Gene, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pathway_df</span> <span class="o">=</span> <span class="n">PathwayAnalyserV2</span><span class="o">.</span><span class="n">run_overrepresentation_analysis</span><span class="p">(</span><span class="n">topDEgenes</span><span class="p">)</span> <span class="c1"># this is a wrapper function call for GSEAPy enrichr inferface</span>
<span class="n">pathway_df</span><span class="p">[</span><span class="n">pathway_df</span><span class="p">[</span><span class="s1">&#39;Adjusted P-value&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.001</span><span class="p">]</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Gene_set</th>
      <th>Term</th>
      <th>Overlap</th>
      <th>P-value</th>
      <th>Adjusted P-value</th>
      <th>Old P-value</th>
      <th>Old Adjusted P-value</th>
      <th>Odds Ratio</th>
      <th>Combined Score</th>
      <th>Genes</th>
      <th>-log10 Adjusted P-value</th>
      <th>-log10 FDR q-val</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>KEGG_2021_Human</td>
      <td>C-type lectin receptor signaling pathway</td>
      <td>4/104</td>
      <td>1.414253e-07</td>
      <td>0.000007</td>
      <td>0</td>
      <td>0</td>
      <td>132.600000</td>
      <td>2091.300110</td>
      <td>NFKBIA;NLRP3;TNF;MALT1</td>
      <td>5.182020</td>
      <td>5.182020</td>
    </tr>
    <tr>
      <th>14</th>
      <td>KEGG_2021_Human</td>
      <td>NF-kappa B signaling pathway</td>
      <td>4/104</td>
      <td>1.414253e-07</td>
      <td>0.000007</td>
      <td>0</td>
      <td>0</td>
      <td>132.600000</td>
      <td>2091.300110</td>
      <td>NFKBIA;TNF;CXCL2;MALT1</td>
      <td>5.182020</td>
      <td>5.182020</td>
    </tr>
    <tr>
      <th>0</th>
      <td>MSigDB_Hallmark_2020</td>
      <td>TNF-alpha Signaling via NF-kB</td>
      <td>4/200</td>
      <td>1.944057e-06</td>
      <td>0.000013</td>
      <td>0</td>
      <td>0</td>
      <td>67.326531</td>
      <td>885.393278</td>
      <td>NFKBIA;CCRL2;TNF;CXCL2</td>
      <td>4.898378</td>
      <td>4.898378</td>
    </tr>
    <tr>
      <th>1</th>
      <td>MSigDB_Hallmark_2020</td>
      <td>Inflammatory Response</td>
      <td>4/200</td>
      <td>1.944057e-06</td>
      <td>0.000013</td>
      <td>0</td>
      <td>0</td>
      <td>67.326531</td>
      <td>885.393278</td>
      <td>NFKBIA;C5AR1;CCRL2;NLRP3</td>
      <td>4.898378</td>
      <td>4.898378</td>
    </tr>
    <tr>
      <th>15</th>
      <td>KEGG_2021_Human</td>
      <td>NOD-like receptor signaling pathway</td>
      <td>4/181</td>
      <td>1.305897e-06</td>
      <td>0.000040</td>
      <td>0</td>
      <td>0</td>
      <td>74.625235</td>
      <td>1011.068962</td>
      <td>NFKBIA;NLRP3;TNF;CXCL2</td>
      <td>4.392729</td>
      <td>4.392729</td>
    </tr>
    <tr>
      <th>16</th>
      <td>KEGG_2021_Human</td>
      <td>Lipid and atherosclerosis</td>
      <td>4/215</td>
      <td>2.592326e-06</td>
      <td>0.000048</td>
      <td>0</td>
      <td>0</td>
      <td>62.492891</td>
      <td>803.843248</td>
      <td>NFKBIA;NLRP3;TNF;CXCL2</td>
      <td>4.316101</td>
      <td>4.316101</td>
    </tr>
    <tr>
      <th>17</th>
      <td>KEGG_2021_Human</td>
      <td>Legionellosis</td>
      <td>3/57</td>
      <td>2.596486e-06</td>
      <td>0.000048</td>
      <td>0</td>
      <td>0</td>
      <td>158.222222</td>
      <td>2034.951617</td>
      <td>NFKBIA;TNF;CXCL2</td>
      <td>4.316101</td>
      <td>4.316101</td>
    </tr>
    <tr>
      <th>18</th>
      <td>KEGG_2021_Human</td>
      <td>Coronavirus disease</td>
      <td>4/232</td>
      <td>3.507534e-06</td>
      <td>0.000054</td>
      <td>0</td>
      <td>0</td>
      <td>57.783626</td>
      <td>725.796849</td>
      <td>NFKBIA;C5AR1;NLRP3;TNF</td>
      <td>4.264666</td>
      <td>4.264666</td>
    </tr>
    <tr>
      <th>19</th>
      <td>KEGG_2021_Human</td>
      <td>Shigellosis</td>
      <td>4/246</td>
      <td>4.425543e-06</td>
      <td>0.000059</td>
      <td>0</td>
      <td>0</td>
      <td>54.402204</td>
      <td>670.676767</td>
      <td>NFKBIA;NLRP3;TNF;MALT1</td>
      <td>4.230649</td>
      <td>4.230649</td>
    </tr>
    <tr>
      <th>20</th>
      <td>KEGG_2021_Human</td>
      <td>IL-17 signaling pathway</td>
      <td>3/94</td>
      <td>1.177987e-05</td>
      <td>0.000137</td>
      <td>0</td>
      <td>0</td>
      <td>93.715856</td>
      <td>1063.592345</td>
      <td>NFKBIA;TNF;CXCL2</td>
      <td>3.863467</td>
      <td>3.863467</td>
    </tr>
    <tr>
      <th>21</th>
      <td>KEGG_2021_Human</td>
      <td>T cell receptor signaling pathway</td>
      <td>3/104</td>
      <td>1.596141e-05</td>
      <td>0.000165</td>
      <td>0</td>
      <td>0</td>
      <td>84.394625</td>
      <td>932.167056</td>
      <td>NFKBIA;TNF;MALT1</td>
      <td>3.782688</td>
      <td>3.782688</td>
    </tr>
    <tr>
      <th>22</th>
      <td>KEGG_2021_Human</td>
      <td>TNF signaling pathway</td>
      <td>3/112</td>
      <td>1.993521e-05</td>
      <td>0.000185</td>
      <td>0</td>
      <td>0</td>
      <td>78.169069</td>
      <td>846.025656</td>
      <td>NFKBIA;TNF;CXCL2</td>
      <td>3.731896</td>
      <td>3.731896</td>
    </tr>
    <tr>
      <th>23</th>
      <td>KEGG_2021_Human</td>
      <td>Yersinia infection</td>
      <td>3/137</td>
      <td>3.642707e-05</td>
      <td>0.000308</td>
      <td>0</td>
      <td>0</td>
      <td>63.505330</td>
      <td>649.037070</td>
      <td>NFKBIA;NLRP3;TNF</td>
      <td>3.511485</td>
      <td>3.511485</td>
    </tr>
    <tr>
      <th>24</th>
      <td>KEGG_2021_Human</td>
      <td>Influenza A</td>
      <td>3/172</td>
      <td>7.174680e-05</td>
      <td>0.000556</td>
      <td>0</td>
      <td>0</td>
      <td>50.264582</td>
      <td>479.643099</td>
      <td>NFKBIA;NLRP3;TNF</td>
      <td>3.254896</td>
      <td>3.254896</td>
    </tr>
    <tr>
      <th>25</th>
      <td>KEGG_2021_Human</td>
      <td>Pathogenic Escherichia coli infection</td>
      <td>3/197</td>
      <td>1.073310e-04</td>
      <td>0.000768</td>
      <td>0</td>
      <td>0</td>
      <td>43.731959</td>
      <td>399.692315</td>
      <td>NFKBIA;NLRP3;TNF</td>
      <td>3.114735</td>
      <td>3.114735</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="clustering-genes-using-their-alignments">
<h1>Clustering genes using their alignments<a class="headerlink" href="#clustering-genes-using-their-alignments" title="Permalink to this heading"></a></h1>
<p>We first run cluster diagnostics to decide on a distance threshold with a good tradeoff between the number of clusters and the quality of structure. We use levenshtein distance metric</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Running experiment to determine the distance threshold with a good trade-off</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ClusterUtils</span><span class="o">.</span><span class="n">run_clustering</span><span class="p">(</span><span class="n">aligner</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;levenshtein&#39;</span><span class="p">,</span> <span class="n">experiment_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>compute distance matrix
using levenshtein distance metric
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 68%|██████▊   | 67/99 [00:00&lt;00:00, 248.94it/s]
</pre></div>
</div>
<img alt="../_images/a26fdcf8a6a8dac35b6be3103d34a63301abebd8099ef415b6fb37c05291d90e.png" src="../_images/a26fdcf8a6a8dac35b6be3103d34a63301abebd8099ef415b6fb37c05291d90e.png" />
</div>
</div>
<p>We can inspect structures of distance thresholds that give local optimals of the mean silhouette score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Mean Silhouette Score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.37</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Distance threshold&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Distance threshold</th>
      <th>Mean Silhouette Score</th>
      <th>Number of clusters</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>66</th>
      <td>0.67</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>65</th>
      <td>0.66</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>64</th>
      <td>0.65</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>0.64</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>62</th>
      <td>0.63</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>61</th>
      <td>0.62</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>60</th>
      <td>0.61</td>
      <td>0.371279</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>59</th>
      <td>0.60</td>
      <td>0.395886</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>58</th>
      <td>0.59</td>
      <td>0.395886</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>57</th>
      <td>0.58</td>
      <td>0.395886</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>56</th>
      <td>0.57</td>
      <td>0.395886</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>55</th>
      <td>0.56</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>54</th>
      <td>0.55</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>53</th>
      <td>0.54</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>52</th>
      <td>0.53</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>51</th>
      <td>0.52</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0.51</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>49</th>
      <td>0.50</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>48</th>
      <td>0.49</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>47</th>
      <td>0.48</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>46</th>
      <td>0.47</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0.46</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>44</th>
      <td>0.45</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>43</th>
      <td>0.44</td>
      <td>0.391956</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>39</th>
      <td>0.40</td>
      <td>0.374176</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>38</th>
      <td>0.39</td>
      <td>0.374176</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>37</th>
      <td>0.38</td>
      <td>0.374176</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>36</th>
      <td>0.37</td>
      <td>0.374944</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.10</td>
      <td>0.384710</td>
      <td>57.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.09</td>
      <td>0.398382</td>
      <td>65.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.08</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.07</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.06</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.05</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.04</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.03</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.02</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.01</td>
      <td>0.415730</td>
      <td>68.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we select distance threshold 0.37 which gives a local optimal of 0.3749 silhouette_score with 7 clusters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ClusterUtils</span><span class="o">.</span><span class="n">run_clustering</span><span class="p">(</span><span class="n">aligner</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;levenshtein&#39;</span><span class="p">,</span> <span class="n">DIST_THRESHOLD</span><span class="o">=</span><span class="mf">0.37</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>compute distance matrix
using levenshtein distance metric
run agglomerative clustering |  0.37
silhouette_score:  0.37494418907841714
</pre></div>
</div>
</div>
</div>
<p>Below visualizes all alignment paths in each cluster along with its number of genes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ClusterUtils</span><span class="o">.</span><span class="n">visualise_clusters</span><span class="p">(</span><span class="n">aligner</span><span class="p">,</span><span class="n">n_cols</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ac99bfa573fced861e8c64a8641ff4621e879cafff89c1082a13d55a64e506d6.png" src="../_images/ac99bfa573fced861e8c64a8641ff4621e879cafff89c1082a13d55a64e506d6.png" />
</div>
</div>
<p>Below is the Levenshtein distance heat map of all genes ordered based on the above clustering structure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">VisualUtils</span><span class="o">.</span><span class="n">plot_distmap_with_clusters</span><span class="p">(</span><span class="n">aligner</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/58f3c09a4c27a161a12922d47eafa60f7e08d0879ce897dc6366bc05fe4d6ce3.png" src="../_images/58f3c09a4c27a161a12922d47eafa60f7e08d0879ce897dc6366bc05fe4d6ce3.png" />
</div>
</div>
<p>Print the cluster-specific aggregate (average) alignments for each cluster along with its number of genes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ClusterUtils</span><span class="o">.</span><span class="n">print_cluster_average_alignments</span><span class="p">(</span><span class="n">aligner</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cluster:  0 IDDDMMMMMMMMIIIIIDDD 18
cluster:  1 IIIDIDIDIDIDDDMMMMMMM 3
cluster:  2 IDDDMMMMMMMMMMIIDI 36
cluster:  3 IDDDMMMMMIMVVVVVIDDDDD 12
cluster:  4 IIIDDDDDDDMMMMMMIIIIID 12
cluster:  5 IIIDIDIDDDDDDMMMMVMVVM 2
cluster:  6 DDMMMMMMMMIIMMMM 6
</pre></div>
</div>
</div>
</div>
</section>
<section id="gene-set-specific-alignments">
<h1>Gene-set specific alignments<a class="headerlink" href="#gene-set-specific-alignments" title="Permalink to this heading"></a></h1>
<p>We can obtain the aggregate (average) alignment for any given gene subset in the aligner</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GENE_SUBSET</span> <span class="o">=</span> <span class="n">gene_list</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">60</span><span class="p">]</span>
<span class="n">aligner</span><span class="o">.</span><span class="n">get_aggregate_alignment_for_subset</span><span class="p">(</span><span class="n">GENE_SUBSET</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average Alignment:  IDDDMMMMMMMIIDIIIIDDD
</pre></div>
</div>
<img alt="../_images/561939030134240ae731fdaf091e92c989c5dc668ccb71cab3fb1008ddadfc4c.png" src="../_images/561939030134240ae731fdaf091e92c989c5dc668ccb71cab3fb1008ddadfc4c.png" />
</div>
</div>
<p>We can check aggregate alignment and statistics of a pathway gene set with below provided wrapper function calls to retrieve pathway gene sets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">IGS</span> <span class="o">=</span> <span class="n">PathwayAnalyserV2</span><span class="o">.</span><span class="n">InterestingGeneSets</span><span class="p">(</span><span class="n">MSIGDB_PATH</span><span class="o">=</span><span class="s1">&#39;../MSIGDB/msigdb7.5.1/&#39;</span><span class="p">)</span>
<span class="n">IGS</span><span class="o">.</span><span class="n">add_new_set_from_msigdb</span><span class="p">(</span><span class="s1">&#39;hallmark&#39;</span><span class="p">,</span> <span class="s1">&#39;HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION&#39;</span><span class="p">,</span> <span class="n">aligner</span><span class="o">.</span><span class="n">gene_list</span><span class="p">,</span> <span class="s1">&#39;EMT&#39;</span><span class="p">)</span>   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PathwayAnalyserV2</span><span class="o">.</span><span class="n">get_pathway_alignment_stat</span><span class="p">(</span><span class="n">aligner</span><span class="p">,</span> <span class="n">IGS</span><span class="o">.</span><span class="n">SETS</span><span class="p">[</span><span class="s1">&#39;EMT&#39;</span><span class="p">],</span> <span class="s1">&#39;EMT&#39;</span><span class="p">,</span> <span class="n">cluster</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">FIGSIZE</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean matched percentage:  51.04 %
mean matched percentage wrt ref:  64.29 %
mean matched percentage wrt query:  67.14 %
Average Alignment:  IDDDMMMMMMMMMMIMI
Z-normalised Interpolated mean trends
</pre></div>
</div>
<img alt="../_images/21bde91f0cf441f6e0b83164dc91ae20106399b58b59ea446fe1360130b89d59.png" src="../_images/21bde91f0cf441f6e0b83164dc91ae20106399b58b59ea446fe1360130b89d59.png" />
<img alt="../_images/72ff20b01b33de3342d3d0b25986dba1f16ca456780e54094b50ff646bcfe058.png" src="../_images/72ff20b01b33de3342d3d0b25986dba1f16ca456780e54094b50ff646bcfe058.png" />
</div>
</div>
</section>
<section id="complementary-functions">
<h1>Complementary functions<a class="headerlink" href="#complementary-functions" title="Permalink to this heading"></a></h1>
<p>Show all alignments</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aligner</span><span class="o">.</span><span class="n">show_ordered_alignments</span><span class="p">()</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Gene      Alignment
--------  ------------------------
PTAFR     MDDMMMMMMMMMMIIDI
OSBPL3    MDMMMMMMVVVVVVDIDDDDD
RFFL      MDDDMMMMMMMMMMIII
TNFAIP2   MDDMMMMMMMIIDIIIIDDD
SGMS2     DMMMMMMMMMMMMIM
SLC16A10  DMMMMMMMMMMMIIIDD
FPR1      DMMMMMMMMMIIDIIIDDD
FAM20C    DMMMMMMMMDDDMMIIII
CLEC4D    IMMDIDMMMMMMMIIIDDD
TSHZ1     DDMMMMMMMVVVVVVIDDDDD
IL1F9     DDMMMMMMMVVVVVVIDDDDD
PSTPIP2   DDMMMMMMMVVVVVIDIDDDD
RELA      DDMMMMMMMMMMMMII
NUP54     DDMMMMMMMMMMMMII
DDHD1     DDMMMMMMMMMMMMII
NRP2      DDMMMMMMMMMMMIIID
TREM1     DDMMMMMMMMMIIDIIIDD
GRAMD1B   DDMMMMMMMMMIIMMM
TOP1      DDMMMMMMMMIDIIIIIDDD
ICOSL     DDMMMMMMMMIIMMMM
DUSP16    DDMMMMMMMMIIMMMM
PTPRE     DDMMMMMMMMIIIIIIDDDD
LDLR      DDMMMMMMMMIIDIIIIDDD
TNIP1     DDMMMMMMMMIIIIIIDDDD
PLAGL2    DDDMMMMMMMMMMMVVV
ZSWIM4    DDDMMMMMMMMMMMVVV
ZC3H12C   DDDMMMMMMVVVVVVVIDDDDD
AK150559  DDDMMMMMVVVVVVVVIDDDDDD
F10       IDDMMMMVVVVVVVVIDDDDDDDD
FAM108C   DDDMMMMMMMMMMMIII
RBM7      DDDMMMMMMMMMMMIII
RASA2     DDDMMMMMMMMMMMIII
SLC25A37  DDDMMMMMMMMMMMIII
IRAK-2    DDDMMMMMMMMMMIIIID
PLEKHO2   DDDMMMMMMMMMMIIIID
LCP2      DDDMMMMMMMMMIIIIIDD
TRIM13    DDDMMMMMMMMMIIIMM
PTX3      DDDMMMMMMIIIMMMMM
SPATA13   IDDMMMMMMIDIIIIIIDDDDD
BCL2L11   IDDMMMDMMMMMMMMII
CD44      DDIDMMMMMMMMMMMVV
AK163103  DDIDMMMMMMVVVVVVIDDDDD
LZTFL1    DDIDMMMMMMVVVVVVIDDDDD
IRAK3     DDIDMMMMMVVVVVVIIDDDDDD
ARG2      DDIDMMMMMMMMMMMII
ZEB2      DDIDMMMMMMMMMMIIID
TLR2      DDIDMMMMMMMMMMIIID
MCOLN2    DDIDMMMMMMMMMMIIID
CPD       IDIDMMMMMMMMMIIIDDD
RCAN1     DDDDMMMMMMMIIIMMMI
PILRA     DDIDMMMMMMMIDIIIIIDDD
ARHGEF3   DDIDMMMMMMMIIMMMM
C5AR1     IIIDMMMMMMIIIIIDDDDDDD
SLC39A14  DDIDMMMMMMDDMMMIIII
CLCN7     DDDIDMMMMMMVVVVVVIDDDD
BC031781  DDDIDMMMMMMMMMIIIID
NUPR1     DDDIDMMMMMMMMMIIIID
CDC42EP4  DDDIDMMMMMMMMMIIIID
NFKBIE    DDDIDMMMMMMMMIIIMM
PLSCR1    DDDIDMMMMMMMMIIIIIDD
NCK1      DDDIDMMMMMMMMIIIMM
ADORA2B   DDDIDMMMMMMMMIIIIIDD
ORAI2     DDDIDMMMMMMMIIIIIIDDD
KLF7      DDDIDMMMMMMMIIIIIIDDD
NIACR1    DDDIDDMMMMVVVVVVVVIDDDDD
PDE4B     DDDIDDMMMMMMMMMIIII
SERTAD2   DDDIDDMMMMMMMMIIIIID
CXCL1     DDDIDDMMMMMMMIIIIIIDD
MPP5      DDDIDDMMMMMIIMMMIIID
TGM2      DDDIDIDMMMMMMMMMIII
PIP5K1A   IDDIDIDMMMMMMMMMIID
FLRT3     DDDIDDDMMMMMMMMIIIII
SOCS3     DDDIDDDDMMMVVVVVIMMMM
TNFAIP3   DDDIDDDDMMMMMMMIIIIII
RASGEF1B  DDDIDDDDMMMMMMMIIIIII
SLC25A25  DDDIDDDDMMMMMMIIIIIIM
INSIG1    DDDIDDDDMMMMMMIIIIIIID
CXCL2     DDDIDIDDMMMMMMIIIIIIDD
MALT1     DDDIDIDDDMMMMMMIIIIIID
RALGDS    DDDIDIDDDMMMMMMIIIIIID
H1F0      DDDIDIDIDMMMMMIIIMMM
IL1A      DDDIDIDIDDMMMMMMMIIII
NLRP3     DDDIDIDIDDMMMMMIIIIIIDD
TNF       DDDIDIDIDDDMMMMMIIIIIID
NFKBIA    DDDIDIDIDDDMMMMMIIIIIID
PLK2      IIIDIDIDIDDDMMMMMMMID
NFKBIZ    DDDIDIDDDDDIVVVVVVVDMMMM
NFKBID    IIIDIDIDIDDDDMMMMMMMI
CCRL2     IIIDIDIDIDIIIDDDDDMMMMM
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>30      PTAFR
40     OSBPL3
74       RFFL
80    TNFAIP2
26      SGMS2
       ...   
77     NFKBIA
81       PLK2
88     NFKBIZ
46     NFKBID
63      CCRL2
Name: genes, Length: 89, dtype: object
</pre></div>
</div>
</div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dinithi Sumanaweera, Teichmann Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>